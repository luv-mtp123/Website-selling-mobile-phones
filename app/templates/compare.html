{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-5 pt-3">
    <h1 class="text-primary fw-bold display-5">
        <span class="text-dark">AI</span> <span class="text-danger">VS</span> Battle
    </h1>
    <p class="lead text-muted">So sánh chi tiết thông số và nhận tư vấn từ chuyên gia AI</p>
</div>

<div class="card shadow-lg border-0 rounded-4 mb-5 overflow-hidden">
    <div class="card-header bg-dark text-white p-4 text-center">
        <h4 class="mb-0 text-uppercase fw-bold">Chọn sản phẩm mà bạn muốn so sánh</h4>
    </div>
    <div class="card-body p-5 bg-light">
        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="row align-items-center">
                <!-- SP 1 -->
                <div class="col-md-5">
                    <div class="form-floating">
                        <select name="product1" class="form-select shadow-sm fw-bold text-primary" id="p1" required>
                            <option value="" disabled selected>Chọn sản phẩm trái</option>
                            {% for p in products %}
                            <option value="{{ p.id }}" {% if p1 and p1.id == p.id %}selected{% endif %}>{{ p.name }}</option>
                            {% endfor %}
                        </select>
                        <label for="p1">Sản phẩm 1</label>
                    </div>
                </div>

                <!-- VS Icon -->
                <div class="col-md-2 text-center my-3 my-md-0">
                    <div class="rounded-circle bg-danger text-white d-inline-flex align-items-center justify-content-center shadow-lg" style="width: 70px; height: 70px; font-weight: 900; font-size: 1.5rem; border: 4px solid white;">VS</div>
                </div>

                <!-- SP 2 -->
                <div class="col-md-5">
                    <div class="form-floating">
                        <select name="product2" class="form-select shadow-sm fw-bold text-danger" id="p2" required>
                            <option value="" disabled selected>Chọn sản phẩm phải</option>
                            {% for p in products %}
                            <option value="{{ p.id }}" {% if p2 and p2.id == p.id %}selected{% endif %}>{{ p.name }}</option>
                            {% endfor %}
                        </select>
                        <label for="p2">Sản phẩm 2</label>
                    </div>
                </div>
            </div>

            <div class="text-center mt-5">
                <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm fw-bold text-uppercase scale-hover">
                    <i class="fas fa-bolt me-2 text-warning"></i> Phân Tích Ngay
                </button>
            </div>
        </form>
    </div>
</div>

{% if result %}
<div class="row g-4 animate-up">
    <!-- Hình ảnh trực quan -->
    <div class="col-md-12">
        <div class="row g-0 rounded-4 overflow-hidden shadow-sm mb-4 bg-white">
            <div class="col-6 border-end p-4 text-center">
                <h5 class="fw-bold text-primary">{{ p1.name }}</h5>
                <img src="{{ p1.image_url }}" class="img-fluid my-3" style="max-height: 200px;">
                <h4 class="text-danger">{{ "{:,.0f}".format(p1.price) }} đ</h4>
            </div>
            <div class="col-6 p-4 text-center">
                <h5 class="fw-bold text-danger">{{ p2.name }}</h5>
                <img src="{{ p2.image_url }}" class="img-fluid my-3" style="max-height: 200px;">
                <h4 class="text-danger">{{ "{:,.0f}".format(p2.price) }} đ</h4>
            </div>
        </div>
    </div>

    <!-- Kết quả AI -->
    <div class="col-12">
        <div class="card shadow border-0 rounded-4">
            <div class="card-header bg-gradient-primary text-white p-3">
                <h5 class="mb-0"><i class="fas fa-brain me-2"></i> Kết quả phân tích</h5>
            </div>
            <div class="card-body p-4">
                <div class="table-responsive ai-result-table">
                    <!-- Hiển thị HTML trực tiếp từ AI -->
                    {{ result | safe }}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* CSS riêng cho bảng so sánh */
    .ai-result-table table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    .ai-result-table th, .ai-result-table td { padding: 12px; border: 1px solid #dee2e6; vertical-align: middle; }
    .ai-result-table th { background-color: #f8f9fa; font-weight: bold; text-align: center; }
    .scale-hover:hover { transform: scale(1.05); transition: 0.3s; }
    .animate-up { animation: slideUp 0.5s ease-out; }
    @keyframes slideUp { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
    .bg-gradient-primary { background: linear-gradient(45deg, #0d6efd, #0043a8); }
</style>
{% endif %}
{% endblock %}