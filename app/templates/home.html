{% extends 'base.html' %}

{% block content %}
<style>
    /* --- Banner Animation --- */
    .banner-container {
        overflow: hidden;
        border-radius: 24px;
        position: relative;
        box-shadow: 0 15px 40px rgba(215, 0, 24, 0.2);
        border: 2px solid #ffc107;
    }
    .banner-img {
        transition: transform 0.8s ease-out;
        height: 420px;
        object-fit: cover;
        width: 100%;
    }
    .banner-container:hover .banner-img {
        transform: scale(1.05);
    }
    .banner-overlay {
        background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(215, 0, 24, 0.8) 100%);
    }

    /* --- Feature Icons --- */
    .feature-box {
        background: white;
        padding: 25px 15px;
        border-radius: 18px;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(215, 0, 24, 0.1);
        height: 100%;
    }
    .feature-box:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 25px rgba(215, 0, 24, 0.15);
        border-color: #d70018;
    }
    .feature-icon-circle {
        width: 65px; height: 65px;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.8rem;
        margin: 0 auto 15px;
        background: #fff5f5;
        color: #d70018;
        transition: all 0.3s;
        border: 2px dashed #ffc107;
    }
    .feature-box:hover .feature-icon-circle {
        background: #d70018;
        color: #ffc107;
        border-style: solid;
        transform: rotate(360deg);
    }

    /* --- Smart Search Section --- */
    .search-section {
        background: white;
        border: 2px solid #ffc107;
        box-shadow: 0 10px 30px rgba(255, 193, 7, 0.15);
    }

    /* --- Product Card (Glow Effect) --- */
    .card-product {
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: 20px;
        transition: all 0.4s ease;
        background: #fff;
        overflow: hidden;
    }
    .card-product:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(215, 0, 24, 0.15);
        border-color: #ffc107;
    }
    .product-img-wrapper {
        padding: 25px;
        background: radial-gradient(circle, #fff 0%, #fcfcfc 100%);
        height: 240px;
        display: flex; align-items: center; justify-content: center;
        position: relative;
    }
    .product-img-wrapper img {
        max-height: 100%;
        max-width: 100%;
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .card-product:hover .product-img-wrapper img {
        transform: scale(1.15);
    }

    /* --- Flash Sale Timer --- */
    .flash-sale-box {
        background: linear-gradient(45deg, #d70018 0%, #b30014 100%);
        border: 2px solid #ffc107;
        color: white;
    }
    .timer-digit {
        background: #ffc107;
        color: #d70018;
        padding: 6px 10px;
        border-radius: 8px;
        font-weight: 900;
        min-width: 38px;
        display: inline-block;
        text-align: center;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }

    /* --- Category Pills --- */
    .cat-pill {
        border: 2px solid #ffeeba;
        color: #555;
        background: white;
        padding: 8px 20px;
        border-radius: 50px;
        font-weight: 700;
        transition: 0.3s;
        text-decoration: none;
    }
    .cat-pill:hover, .cat-pill.active {
        background: #d70018;
        color: #ffc107;
        border-color: #d70018;
        box-shadow: 0 4px 10px rgba(215, 0, 24, 0.3);
    }

    /* Th√™m n√∫t add-cart ƒë·∫πp */
    .btn-add-cart-hover {
        background: white; color: #d70018; border: 2px solid #d70018; font-weight: bold; transition: 0.3s;
    }
    .btn-add-cart-hover:hover {
        background: #d70018; color: white;
    }
</style>

<!-- 1. Banner T·∫øt -->
<div class="banner-container mb-5">
    <img src="https://brocanvas.vn/wp-content/uploads/2025/11/Anh-chuc-mung-nam-moi-Binh-Ngo-2026.jpg" class="banner-img" alt="Tet Banner">
    <div class="card-img-overlay d-flex flex-column justify-content-end align-items-center text-center pb-5 banner-overlay">
        <h1 class="display-3 fw-bold text-warning mb-2" style="text-shadow: 2px 4px 8px rgba(0,0,0,0.8); font-family: 'Times New Roman', serif;">XU√ÇN B√çNH NG·ªå 2026</h1>
        <p class="fs-4 fw-bold mb-4 text-white" style="text-shadow: 1px 2px 4px rgba(0,0,0,0.8);">S·∫Øm D·∫ø Y√™u - R∆∞·ªõc Nhi·ªÅu T√†i L·ªôc üßß</p>
        <a href="#products" class="btn btn-warning btn-lg rounded-pill px-5 py-3 fw-bold text-danger shadow-lg" style="border: 2px solid white;">
            <i class="fas fa-gift me-2"></i> KH√ÅM PH√Å NGAY
        </a>
    </div>
</div>

<!-- 2. Feature Icons -->
<div class="row text-center mb-5 g-4">
    <div class="col-6 col-md-3">
        <div class="feature-box">
            <div class="feature-icon-circle"><i class="fas fa-rocket"></i></div>
            <h6 class="fw-bold text-danger mb-1">Giao H·ªèa T·ªëc 2H</h6>
            <p class="small text-muted mb-0">Xuy√™n su·ªët m√πng 1 ƒë·∫øn m√πng 3</p>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="feature-box">
            <div class="feature-icon-circle"><i class="fas fa-gem"></i></div>
            <h6 class="fw-bold text-danger mb-1">B·∫£o H√†nh V√†ng</h6>
            <p class="small text-muted mb-0">R∆°i v·ª°, v√†o n∆∞·ªõc v·∫´n ƒë·ªïi m·ªõi</p>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="feature-box">
            <div class="feature-icon-circle"><i class="fas fa-hand-holding-usd"></i></div>
            <h6 class="fw-bold text-danger mb-1">Tr·∫£ G√≥p 0 L√£i</h6>
            <p class="small text-muted mb-0">Kh√¥ng c·∫ßn tr·∫£ tr∆∞·ªõc - L·∫•y m√°y ngay</p>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="feature-box">
            <div class="feature-icon-circle"><i class="fas fa-gift"></i></div>
            <h6 class="fw-bold text-danger mb-1">100% Tr√∫ng L√¨ X√¨</h6>
            <p class="small text-muted mb-0">Quay v√≤ng quay - Tr√∫ng v√†ng 9999</p>
        </div>
    </div>
</div>

<!-- 3. AI Smart Search -->
<div class="card p-4 mb-5 rounded-4 search-section position-relative" id="products">
    <div class="position-absolute top-0 end-0 p-3 opacity-25 d-none d-md-block">
        <i class="fas fa-brain fa-4x text-danger"></i>
    </div>
    <div class="d-flex align-items-center mb-4">
        <div class="bg-danger text-warning rounded-circle p-2 me-3 d-flex align-items-center justify-content-center shadow" style="width: 50px; height: 50px; font-size: 1.5rem;">
            <i class="fas fa-magic"></i>
        </div>
        <div>
            <h4 class="mb-0 fw-bold text-danger">T√¨m Ki·∫øm AI Th√¥ng Minh</h4>
            <small class="text-muted fw-bold">Nh·∫≠p "T√¥i mu·ªën mua ƒëi·ªán tho·∫°i Samsung ch∆°i game t·ªët gi√° 10 tri·ªáu"</small>
        </div>
    </div>
    <form action="/" method="GET" class="row g-3">
        <div class="col-lg-6">
            <div class="input-group input-group-lg shadow-sm rounded-pill overflow-hidden border border-danger">
                <span class="input-group-text bg-white border-0 text-danger ps-4"><i class="fas fa-search"></i></span>
                <input type="text" name="q" class="form-control border-0 shadow-none"
                       placeholder="Nh·∫≠p nhu c·∫ßu c·ªßa b·∫°n..."
                       value="{{ search_query }}">
            </div>
        </div>
        <div class="col-lg-2 col-6">
            <select name="brand" class="form-select form-select-lg rounded-pill shadow-sm border-danger text-center fw-bold">
                <option value="">T·∫•t c·∫£ h√£ng</option>
                {% for b in brands %}
                <option value="{{ b }}" {% if request.args.get('brand') == b %}selected{% endif %}>{{ b }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-lg-2 col-6">
            <select name="sort" class="form-select form-select-lg rounded-pill shadow-sm border-danger text-center fw-bold">
                <option value="">M·∫∑c ƒë·ªãnh</option>
                <option value="price_asc" {% if request.args.get('sort') == 'price_asc' %}selected{% endif %}>Gi√° r·∫ª nh·∫•t</option>
                <option value="price_desc" {% if request.args.get('sort') == 'price_desc' %}selected{% endif %}>T·ª´ cao xu·ªëng</option>
            </select>
        </div>
        <div class="col-lg-2">
            <button type="submit" class="btn btn-danger btn-lg w-100 fw-bold rounded-pill shadow">T√¨m L·ªôc</button>
        </div>
    </form>
</div>

{% if ai_message %}
<div class="alert alert-warning border-0 shadow d-flex align-items-center mb-5 rounded-4 p-4" role="alert">
    <i class="fas fa-robot fa-2x me-3 text-danger animate__animated animate__tada animate__infinite"></i>
    <div class="text-dark fw-bold fs-5">
        {{ ai_message }}
    </div>
</div>
{% endif %}

<!-- 4. Flash Sale -->
<div class="d-flex align-items-center justify-content-between mb-4 flash-sale-box p-4 rounded-4 shadow">
    <div class="d-flex align-items-center">
        <i class="fas fa-bolt text-warning fs-1 me-3 animate__animated animate__flash animate__infinite"></i>
        <div>
            <h2 class="fw-bold text-warning mb-0" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">GI·ªú V√ÄNG GI√Å S·ªêC</h2>
            <small class="text-white fw-bold">Ch·ªët deal ngay - Bay s·∫°ch kho</small>
        </div>
    </div>
    <div class="d-flex align-items-center gap-2">
        <span class="text-white fw-bold text-uppercase d-none d-md-inline">K·∫øt th√∫c sau:</span>
        <span class="timer-digit fs-4" id="hour">02</span><span class="fw-bold text-warning fs-4">:</span>
        <span class="timer-digit fs-4" id="min">45</span><span class="fw-bold text-warning fs-4">:</span>
        <span class="timer-digit fs-4" id="sec">12</span>
    </div>
</div>

{% if hot_products %}
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4 mb-5">
    {% for product in hot_products %}
    <div class="col">
        <div class="card h-100 card-product">
            <div class="position-absolute top-0 end-0 m-2 badge bg-danger rounded-pill shadow-sm z-3">-15%</div>
            <a href="/product/{{ product.id }}" class="product-img-wrapper">
                <img src="{{ product.image_url }}" alt="{{ product.name }}">
            </a>
            <div class="card-body d-flex flex-column pt-3">
                <h6 class="card-title fw-bold text-truncate mb-1">
                    <a href="/product/{{ product.id }}" class="text-dark text-decoration-none">{{ product.name }}</a>
                </h6>
                <div class="mb-3">
                    <span class="text-danger fw-bold fs-5 me-2">{{ product.sale_price | vnd }}</span>
                    <small class="text-decoration-line-through text-muted">{{ product.price | vnd }}</small>
                </div>
                <div class="mt-auto">
                    <div class="progress mb-2" style="height: 6px; border-radius: 10px;">
                        <div class="progress-bar bg-danger progress-bar-striped progress-bar-animated" style="width: 85%"></div>
                    </div>
                    <small class="text-danger fw-bold d-block mb-3"><i class="fas fa-fire me-1"></i>ƒêang b√°n ch·∫°y</small>
                    <form action="/cart/add/{{ product.id }}" method="POST" class="d-grid position-relative z-3">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-outline-danger rounded-pill fw-bold py-2">
                            MUA NGAY
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- 5. All Products -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
    <h3 class="fw-bold text-danger border-start border-5 border-warning ps-3 mb-0" style="text-shadow: 1px 1px 1px rgba(0,0,0,0.1);">T·∫§T C·∫¢ S·∫¢N PH·∫®M</h3>
    <div class="d-flex gap-2 overflow-auto pb-2 pb-md-0 px-2">
        <a href="/" class="cat-pill active">T·∫•t c·∫£</a>
        <a href="/?brand=Apple" class="cat-pill">Apple</a>
        <a href="/?brand=Samsung" class="cat-pill">Samsung</a>
        <a href="/?brand=Xiaomi" class="cat-pill">Xiaomi</a>
    </div>
</div>

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    {% for product in products %}
    <div class="col">
        <div class="card h-100 card-product position-relative">
            {% if product.is_sale %}
            <div class="position-absolute top-0 start-0 m-2 badge bg-warning text-dark fw-bold shadow-sm p-2 z-2">
                <i class="fas fa-tag me-1"></i> SALE
            </div>
            {% endif %}

            <a href="/product/{{ product.id }}" class="product-img-wrapper">
                <img src="{{ product.image_url }}" alt="{{ product.name }}" onerror="this.src='https://via.placeholder.com/300x200?text=MobileStore'">
            </a>

            <div class="card-body d-flex flex-column pt-3">
                <div class="mb-2">
                    <span class="badge bg-light text-secondary border rounded-pill px-2">{{ product.brand }}</span>
                </div>
                <h6 class="card-title fw-bold text-dark text-truncate mb-1">
                    <a href="/product/{{ product.id }}" class="text-decoration-none text-dark stretched-link">{{ product.name }}</a>
                </h6>

                <div class="mb-3">
                    {% if product.is_sale %}
                        <div class="d-flex align-items-center">
                            <span class="h5 text-danger fw-bold mb-0 me-2">{{ product.sale_price | vnd }}</span>
                            <span class="text-muted small text-decoration-line-through">{{ product.price | vnd }}</span>
                        </div>
                    {% else %}
                        <div class="h5 text-danger fw-bold mb-0">{{ product.price | vnd }}</div>
                    {% endif %}
                </div>

                <div class="mt-auto">
                    <!-- N√∫t th√™m v√†o gi·ªè n·∫±m tr√™n c√πng layer ƒë·ªÉ kh√¥ng b·ªã stretched-link che m·∫•t -->
                    <form action="/cart/add/{{ product.id }}" method="POST" class="d-grid position-relative z-3">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-outline-primary rounded-pill fw-bold btn-sm py-2">
                             <i class="fas fa-cart-plus me-1"></i> Th√™m V√†o Gi·ªè
                         </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12 text-center py-5">
        </div>
        <h5 class="text-muted fw-bold">Tr·ªëng tr∆°n... Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o!</h5>
        <a href="/" class="btn btn-danger rounded-pill px-4 mt-3 fw-bold">Quay L·∫°i Trang Ch·ªß</a>
    </div>
    {% endfor %}
</div>

<!-- Countdown Script -->
<script>
    function startTimer(duration) {
        var timer = duration, hours, minutes, seconds;
        var hEl = document.getElementById('hour');
        var mEl = document.getElementById('min');
        var sEl = document.getElementById('sec');

        if (!hEl || !mEl || !sEl) return;

        setInterval(function () {
            hours = parseInt(timer / 3600, 10);
            minutes = parseInt((timer % 3600) / 60, 10);
            seconds = parseInt(timer % 60, 10);

            hEl.textContent = hours < 10 ? "0" + hours : hours;
            mEl.textContent = minutes < 10 ? "0" + minutes : minutes;
            sEl.textContent = seconds < 10 ? "0" + seconds : seconds;

            if (--timer < 0) timer = duration;
        }, 1000);
    }

    document.addEventListener("DOMContentLoaded", function () {
        var fiveHours = 60 * 60 * 5;
        startTimer(fiveHours);
    });
</script>
{% endblock %}